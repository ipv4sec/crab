"use strict";(self.webpackChunkisland_install_front=self.webpackChunkisland_install_front||[]).push([[923],{6381:(e,t,a)=>{a.d(t,{Z:()=>p});var n=a(5671),i=a(3144),r=a(7326),l=a(9611),c=a(1002);function s(e,t){return!t||"object"!==(0,c.Z)(t)&&"function"!=typeof t?(0,r.Z)(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=a(7294);var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&(0,l.Z)(e,t)}(p,e);var t,a,c=(t=p,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=o(t);if(a){var i=o(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return s(this,e)});function p(e){var t;return(0,n.Z)(this,p),(t=c.call(this,e)).state={value:""},t.txaRef=u.createRef(),t.setData=t.setData.bind((0,r.Z)(t)),t.getData=t.getData.bind((0,r.Z)(t)),t.lineHeight=0,t.padding=0,t.pasteData=!1,t.ctrlKey=!1,t}return(0,i.Z)(p,[{key:"componentDidMount",value:function(){this.lineHeight=parseInt(getComputedStyle(this.txaRef.current).lineHeight),this.padding=2*parseInt(getComputedStyle(this.txaRef.current).paddingTop),this.txaRef.current.style.height=this.padding+this.lineHeight+"px"}},{key:"setData",value:function(e){var t=this;this.setState({value:e},(function(){""===t.state.value.trim()?t.txaRef.current.style.height=t.padding+t.lineHeight+"px":t.txaRef.current.style.height=t.txaRef.current.scrollHeight+"px"}))}},{key:"getData",value:function(){return this.state.value}},{key:"changeValue",value:function(e){this.setState({value:e.target.value})}},{key:"keyDown",value:function(e){var t=this;if(13===e.keyCode)this.txaRef.current.style.height=this.txaRef.current.offsetHeight+this.lineHeight+"px";else if(9===e.keyCode){e.preventDefault();var a=this.txaRef.current.selectionStart,n=this.state.value.substring(0,a)+"    "+this.state.value.substring(a);this.setState({value:n},(function(){t.txaRef.current.selectionStart=a+4,t.txaRef.current.selectionEnd=a+4}))}else 91!=e.keyCode&&17!==e.keyCode||(this.ctrlKey=!0)}},{key:"keyUp",value:function(e){if(8===e.keyCode){var t=e.target.value.split("\n").length*this.lineHeight;t+this.padding<this.txaRef.current.offsetHeight&&(this.txaRef.current.style.height=t+"px")}else if(13===e.keyCode){var a=e.target.value.split("\n").length*this.lineHeight;this.txaRef.current.style.height=a+"px"}else if(9===e.keyCode)e.preventDefault();else if(88===e.keyCode&&this.ctrlKey){var n=e.target.value.split("\n").length*this.lineHeight;this.txaRef.current.style.height=n+"px",this.ctrlKey=!1}}},{key:"autoTxaClick",value:function(){this.txaRef.current.focus()}},{key:"paste",value:function(){this.pasteData=!0}},{key:"componentDidUpdate",value:function(){if(this.pasteData){var e=this.txaRef.current.value.split("\n").length*this.lineHeight;this.txaRef.current.style.height=e+"px",this.pasteData=!1}}},{key:"render",value:function(){return u.createElement("div",{className:"auto-textarea ".concat(this.props.class),onClick:this.autoTxaClick.bind(this)},u.createElement("textarea",{ref:this.txaRef,className:"auto-input",placeholder:"请输入...",value:this.state.value,onChange:this.changeValue.bind(this),onKeyDown:this.keyDown.bind(this),onKeyUp:this.keyUp.bind(this),onPaste:this.paste.bind(this)}))}}]),p}(u.Component)},5923:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var n=a(8390),i=a(7294),r=a(4494),l=a(282),c=a(9669),s=a.n(c),o=a(3411),u=a(5347),p=a(9678),d=a(6105),h=a(6381),f="kind: WorkloadVendor\nmetadata:";const v=(0,r.$j)((function(e){return e}))((function(e){var t=(0,i.useRef)(null),a=(0,i.useRef)(null),r=(0,i.useRef)(null),c=(0,i.useRef)(null),v=((0,i.useRef)(null),(0,i.useRef)(null)),m=(0,i.useRef)(null),y=(0,i.useState)(""),g=(0,n.Z)(y,2),x=g[0],b=g[1],Z=(0,i.useState)(!0),k=(0,n.Z)(Z,2),E=k[0],D=k[1],S=(0,i.useState)(""),w=(0,n.Z)(S,2),R=w[0],C=w[1],N=(0,i.useState)(null),T=(0,n.Z)(N,2),_=T[0],H=T[1],O=(0,i.useState)(!1),j=(0,n.Z)(O,2),P=j[0],V=j[1];(0,i.useEffect)((function(){var e=function(){var e="";if(window.location.search){var t=window.location.search.substring(1);if(t.indexOf("&"))for(var a=t.split("&"),n=0,i=a.length;n<i;n++){var r=a[n].split("=");if(r&&"name"===r[0]){e=r[1];break}}}return e}();c.current.innerText=f,e?(C(e),K(e)):(a.current.setData("apiVersion: aam.globalsphare.com/v1alpha1"),m.current.setData("apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  labels:\n    app: nginx\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n        - name: nginx\n          image: nginx:1.14.2\n          ports:\n            - containerPort: 80\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx\nspec:\n  selector:\n    app: nginx\n  ports:\n    - port: 80\n      name: http"),r.current.setData("name: example"))}),[]);var K=function(e){o.Z.dispatch({type:u.br,val:!0}),s()({method:"GET",url:"/api/online/getworkloadvendor",params:{name:e}}).then((function(e){0==e.data.code?(H(e.data.result||{}),a.current.setData("apiVersion: "+(e.data.result.apiVersion||"")),r.current.setData(e.data.result.metadata||""),m.current.setData(e.data.result.yaml||""),v.current.setData(e.data.result.cue||"")):o.Z.dispatch({type:u.Sn,val:e.data.result})})).catch((function(e){console.log(e),o.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){o.Z.dispatch({type:u.br,val:!1})}))};function M(){var e=/\n/g;return a.current.getData()+"\n"+f+"\n    "+r.current.getData().replace(e,"\n    ")+"\nspec: | \n    "+x.replace(e,"\n    ")+"\n    "+v.current.getData().replace(e,"\n        ")}return(0,i.useEffect)((function(){s()({method:"GET",url:"/api/online/systemspec"}).then((function(e){0==e.data.code?(b(e.data.result||""),t.current.innerText=e.data.result||""):o.Z.dispatch({type:u.Sn,val:e.data.result})})).catch((function(e){console.log(e),o.Z.dispatch({type:u.Sn,val:"请求错误"})}))}),[]),i.createElement("section",{className:"page-container online-container"},i.createElement("header",{className:"online-header"},i.createElement("div",{className:"header-logo"},"Crab")),i.createElement("div",{className:"online-content"},i.createElement("div",{className:"oltitle"},R?"修改":"创建"," WorkloadVendor"),i.createElement("section",{className:"vendor-content"},i.createElement("div",{className:"vendor-left"},i.createElement("div",{className:"online-title"},i.createElement("p",null,"K8s YAML")),i.createElement(h.Z,{ref:m,class:"yaml-textarea"}),i.createElement("div",{className:"online-btns"},i.createElement(l.Z,{className:"online-btn",variant:"contained",color:"primary",onClick:function(){var e=m.current.getData();""!==e.trim()?(o.Z.dispatch({type:u.br,val:!0}),s()({method:"POST",url:"/api/online/translateyaml",data:{value:e},headers:{"Content-Type":"application/json"}}).then((function(e){0==e.data.code?(v.current.setData(e.data.result||""),o.Z.dispatch({type:u.Sn,val:"转换完成"})):o.Z.dispatch({type:u.Sn,val:e.data.result})})).catch((function(e){console.log(e),o.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){o.Z.dispatch({type:u.br,val:!1})}))):o.Z.dispatch({type:u.Sn,val:"请填写yaml"})}},"转换yaml为cue"))),i.createElement("div",{className:"vendor-right"},i.createElement("div",{className:"online-title titlepadding"},i.createElement("p",null,"WorkloadVendor")),i.createElement(h.Z,{ref:a,class:"textarea-edit"}),i.createElement("div",{className:"view-text",ref:c}),i.createElement(h.Z,{ref:r,class:"textarea-edit indent4"}),i.createElement("div",{className:"view-text"},"spec: |",i.createElement("button",{className:"fold-btn",onClick:function(){D(!E)}},i.createElement("span",{className:"iconfont ".concat(E?"icon_navigation_combobox_down":"icon_navigation_combobox_up")}))),i.createElement("div",{className:"vendor-preview indent4 ".concat(E?"hide-textarea":"")},i.createElement("pre",{className:"preview-pre",ref:t})),i.createElement(h.Z,{ref:v,class:"textarea-edit indent4"}),i.createElement("div",{className:"online-btns"},i.createElement(l.Z,{className:"online-btn",variant:"contained",color:"primary",onClick:function(){var e=v.current.getData();""!==e.trim()?(o.Z.dispatch({type:u.br,val:!0}),s()({method:"POST",url:"/api/online/checkcue",data:{value:e},headers:{"Content-Type":"application/json"}}).then((function(e){o.Z.dispatch({type:u.Sn,val:0===e.data.code?"检查正确":e.data.result})})).catch((function(e){console.log(e),o.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){o.Z.dispatch({type:u.br,val:!1})}))):o.Z.dispatch({type:u.Sn,val:"cue 不能为空"})}},"检查")),i.createElement("div",{className:"online-btns"},R?i.createElement(l.Z,{disabled:P,className:"online-btn",variant:"contained",color:"primary",onClick:function(){o.Z.dispatch({type:u.br,val:!0});var e="/api/cluster/editvendor?id=".concat(_.id||"");V(!0),s()({url:e,method:"POST",headers:{"Content-Type":"application/json"},data:{metadata:r.current.getData(),yaml:m.current.getData(),cue:v.current.getData(),value:M()}}).then((function(e){0==e.data.code?setTimeout((function(){V(!1),window.opener.postMessage("workloadtype",window.location.origin),window.close()}),1e3):V(!1),o.Z.dispatch({type:u.Sn,val:e.data.result||""})})).catch((function(e){console.error(e),V(!1),o.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){o.Z.dispatch({type:u.br,val:!1})}))}},"确认修改"):i.createElement(l.Z,{disabled:P,className:"online-btn",variant:"contained",color:"primary",onClick:function(){(""===r.current.getData().trim()?(o.Z.dispatch({type:u.Sn,val:"metadata 不能为空"}),0):""!==v.current.getData().trim()||(o.Z.dispatch({type:u.Sn,val:"cue 不能为空"}),0))&&(o.Z.dispatch({type:u.br,val:!0}),V(!0),s()({method:"POST",url:"/api/online/createvendor",data:{metadata:r.current.getData(),yaml:m.current.getData(),cue:v.current.getData(),value:M()},headers:{"Content-Type":"application/json"}}).then((function(e){o.Z.dispatch({type:u.Sn,val:e.data.result}),0==e.data.code?setTimeout((function(){V(!1),window.opener.postMessage("workloadvendor",window.location.origin),window.close()}),1e3):V(!1)})).catch((function(e){console.log(e),V(!1),o.Z.dispatch({type:u.Sn,val:"请求错误"})})).finally((function(){o.Z.dispatch({type:u.br,val:!1})})))}},"保存"))))),i.createElement(p.Z,null),i.createElement(d.Z,null))}))},5671:(e,t,a)=>{function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}a.d(t,{Z:()=>n})}}]);